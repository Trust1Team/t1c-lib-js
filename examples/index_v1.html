<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>GCL Javascript Test Page</title>
</head>
<body>
	<script src="v1/dist/GCLLib.js" charset="utf-8"></script>
	<script type="text/javascript">
        var gclConfig = new GCLLib.GCLConfig();

        // gclConfig.apiKey = "d555f613-09f8-4a7c-87c6-75c1be9c16c2"; // ING ACC apikey
        gclConfig.apiKey = "77c5e498-dca0-4a69-a04f-3b3732d506b9"; // ING PRD apikey

        // gclConfig.apiKey = "28117840-9426-4edf-9ce3-23fb233e5a85"; //ACC api key alpha credit

        gclConfig.gclUrl = "https://localhost:10443/v1"; //override config for local dev
        //gclConfig.gclUrl = "http://localhost:10080/v1"; //override config for local dev

        // gclConfig.dsUrl = "https://accapim.t1t.be:443"; // ACC
        gclConfig.dsUrl = "https://apim.t1t.be:443"; // ACC

        // gclConfig.dsUrl = "https://accapim.t1t.be/trust1team/gclds/v1";
        //gclConfig.dsUrl = "http://localhost:8080";
        gclConfig.allowAutoUpdate = true;
        gclConfig.implicitDownload = false;
        const connector = new GCLLib.GCLClient(gclConfig);

        // Check if T1C is installed
        connector.core().info(function(err,data) {
            if (err) {
                console.log("T1C not installed");
                connector.core().infoBrowser(function (error, data) {
                    if (error) {
                        console.log("Failed to send the browser info to the backend");
                        return;
                    }

                    connector.ds().downloadLink(data, function (error, data) {
                        if (error) {
                            console.log("Failed to get the download link from the backend");
                            return;
                        }
                        console.log("Download URL: " + data.url);
                    });
                });

                return;
            }

            // T1C already installed.
            console.log("T1C version: " + data.data.version);

            // Check the available readers for a inserted smartcard
            connector.core().readers(function (err, data) {
                if (err) {
                    console.log("Failed to get the list of connected readers");
                    return;
                }

                //console.log(JSON.stringify(data));

                if (!data || !data.data) {
                    console.log("No readers found");
                    return;
                }

                if (data.data.length == 0) {
                    console.log("No readers found");
                    return;
                }

                for (var i = 0; i < data.data.length; i++) {
                    if (!data.data[i].card) {
                        console.log("No card found");
                        return;
                    }

                    console.log("Card found on reader " + data.data[i].id);

                    // Try to read the BeID card
                    var beid = connector.beid(data.data[i].id);

                    var filter = ['rn', 'address'];
                    beid.allData(filter, function (err, data) {
                        if (err) {
                            console.log("Failed to read the BeID card");
                            return;
                        }

                        //console.log("BeID data: " + JSON.stringify(data));
                        console.log("Name: " + data.data.rn.first_names + " " + data.data.rn.name);
                        console.log("Address: " + data.data.address.street_and_number + ", " + data.data.address.zipcode + " " + data.data.address.municipality);
                    });
                }
            });
        });
	</script>
</body>
</html>